# SMARTINVOICE SHIELD
## Há»† THá»NG QUáº¢N TRá»Š & RÃ€ SOÃT Rá»¦I RO HÃ“A ÄÆ N ÄIá»†N Tá»¬
### TÃ i liá»‡u Dá»± Ã¡n ChÃ­nh thá»©c - Production System

---

**PhiÃªn báº£n**: 1.0 Production Edition  
**NgÃ y ban hÃ nh**: 06/02/2026  
**TÃ¬nh tráº¡ng**: Official - Confidential  
**CÆ¡ quan**: AWS First Cloud AI Journey Internship Program  
**Thá»i gian thá»±c hiá»‡n**: 3 thÃ¡ng (12 tuáº§n)  
**Quy mÃ´ team**: 5 thÃ nh viÃªn

---

**TUÃ‚N THá»¦ QUY Äá»ŠNH PHÃP LÃ**:
- Nghá»‹ Ä‘á»‹nh 123/2020/NÄ-CP vá» hÃ³a Ä‘Æ¡n, chá»©ng tá»«
- Quyáº¿t Ä‘á»‹nh sá»‘ 1550/QÄ-TCT vá» Ä‘á»‹nh dáº¡ng hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­
- ThÃ´ng tÆ° 78/2021/TT-BTC hÆ°á»›ng dáº«n thá»±c hiá»‡n

---

## ğŸ“‘ Má»¤C Lá»¤C

### PHáº¦N I: Tá»”NG QUAN Dá»° ÃN
1. [Giá»›i thiá»‡u chung](#1-giá»›i-thiá»‡u-chung)
2. [Má»¥c tiÃªu & Pháº¡m vi](#2-má»¥c-tiÃªu--pháº¡m-vi)
3. [Äá»‹nh hÆ°á»›ng phÃ¡t triá»ƒn](#3-Ä‘á»‹nh-hÆ°á»›ng-phÃ¡t-triá»ƒn)
4. [YÃªu cáº§u tuÃ¢n thá»§ phÃ¡p lÃ½](#4-yÃªu-cáº§u-tuÃ¢n-thá»§-phÃ¡p-lÃ½)

### PHáº¦N II: THIáº¾T Káº¾ Há»† THá»NG
5. [Kiáº¿n trÃºc tá»•ng thá»ƒ](#5-kiáº¿n-trÃºc-tá»•ng-thá»ƒ)
6. [Thiáº¿t káº¿ Database Production](#6-thiáº¿t-káº¿-database-production)
7. [Tech Stack & Services](#7-tech-stack--services)
8. [Security Architecture](#8-security-architecture)

### PHáº¦N III: TRIá»‚N KHAI
9. [PhÃ¢n cÃ´ng Team 5 ngÆ°á»i](#9-phÃ¢n-cÃ´ng-team-5-ngÆ°á»i)
10. [Timeline 12 tuáº§n](#10-timeline-12-tuáº§n)
11. [Quality Assurance](#11-quality-assurance)
12. [Deployment Strategy](#12-deployment-strategy)

### PHáº¦N IV: QUáº¢N LÃ Dá»° ÃN
13. [Risk Management](#13-risk-management)
14. [Change Management](#14-change-management)
15. [Documentation Standards](#15-documentation-standards)

---

# PHáº¦N I: Tá»”NG QUAN Dá»° ÃN

## 1. GIá»šI THIá»†U CHUNG

### 1.1 Bá»‘i cáº£nh dá»± Ã¡n

**Váº¥n Ä‘á» thá»±c táº¿**:
```
Hiá»‡n tráº¡ng xá»­ lÃ½ hÃ³a Ä‘Æ¡n táº¡i doanh nghiá»‡p VN:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ Nháº­p thá»§ cÃ´ng 100% dá»¯ liá»‡u tá»« hÃ³a Ä‘Æ¡n giáº¥y/PDF
âš ï¸ Thá»i gian xá»­ lÃ½: 5-10 phÃºt/hÃ³a Ä‘Æ¡n
âš ï¸ Tá»· lá»‡ sai sÃ³t: 15-20% do nháº­p liá»‡u thá»§ cÃ´ng
âš ï¸ KhÃ´ng phÃ¡t hiá»‡n Ä‘Æ°á»£c hÃ³a Ä‘Æ¡n giáº£, MST khÃ´ng há»£p lá»‡
âš ï¸ Rá»§i ro phÃ¡p lÃ½ cao khi khai thuáº¿ vá»›i hÃ³a Ä‘Æ¡n cÃ³ váº¥n Ä‘á»
âš ï¸ KhÃ´ng cÃ³ há»‡ thá»‘ng quáº£n lÃ½ táº­p trung vÃ  truy váº¿t
âš ï¸ KhÃ³ khÄƒn trong viá»‡c tÃ¬m kiáº¿m, tra cá»©u hÃ³a Ä‘Æ¡n cÅ©
```

**TÃ¡c Ä‘á»™ng kinh doanh**:
- Chi phÃ­ nhÃ¢n cÃ´ng cao (káº¿ toÃ¡n viÃªn lÃ m viá»‡c thá»§ cÃ´ng)
- Rá»§i ro tÃ i chÃ­nh (pháº¡t thuáº¿ khi dÃ¹ng hÃ³a Ä‘Æ¡n khÃ´ng há»£p lá»‡)
- Thiáº¿u minh báº¡ch trong quáº£n lÃ½ chi phÃ­
- KhÃ´ng cÃ³ cÆ¡ cháº¿ cáº£nh bÃ¡o sá»›m vá» rá»§i ro

---

### 1.2 Giáº£i phÃ¡p SmartInvoice Shield

**Äá»‹nh nghÄ©a sáº£n pháº©m**:

SmartInvoice Shield lÃ  há»‡ thá»‘ng SaaS (Software as a Service) quáº£n trá»‹ vÃ  rÃ  soÃ¡t rá»§i ro hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­, cung cáº¥p giáº£i phÃ¡p toÃ n diá»‡n cho doanh nghiá»‡p Viá»‡t Nam trong viá»‡c:

1. **Thu tháº­p & Sá»‘ hÃ³a**: Upload vÃ  tá»± Ä‘á»™ng trÃ­ch xuáº¥t dá»¯ liá»‡u tá»« hÃ³a Ä‘Æ¡n XML/PDF/áº¢nh
2. **RÃ  soÃ¡t & Kiá»ƒm tra**: Validate 3 lá»›p tuÃ¢n thá»§ phÃ¡p luáº­t (Cáº¥u trÃºc/Chá»¯ kÃ½ sá»‘/Nghiá»‡p vá»¥)
3. **Quáº£n lÃ½ & LÆ°u trá»¯**: LÆ°u trá»¯ táº­p trung, phÃ¢n quyá»n, audit trail Ä‘áº§y Ä‘á»§
4. **TÃ¬m kiáº¿m & BÃ¡o cÃ¡o**: TÃ¬m kiáº¿m nhanh, dashboard analytics, export Excel
5. **Cáº£nh bÃ¡o rá»§i ro**: Tá»± Ä‘á»™ng phÃ¡t hiá»‡n hÃ³a Ä‘Æ¡n giáº£, MST khÃ´ng há»£p lá»‡, sai lá»‡ch toÃ¡n há»c

---

### 1.3 GiÃ¡ trá»‹ cá»‘t lÃµi (Core Value Proposition)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "Cáº¯t giáº£m 90% thá»i gian xá»­ lÃ½ hÃ³a Ä‘Æ¡n                      â”‚
â”‚   & PhÃ¡t hiá»‡n 100% rá»§i ro phÃ¡p lÃ½ trÆ°á»›c khi khai thuáº¿"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Tá»± Ä‘á»™ng hÃ³a: AI Ä‘á»c hÃ³a Ä‘Æ¡n thay con ngÆ°á»i
âœ… TuÃ¢n thá»§ 100%: Validate theo Nghá»‹ Ä‘á»‹nh 123/2020/NÄ-CP
âœ… An toÃ n: Anti-Spoofing, kiá»ƒm tra chá»¯ kÃ½ sá»‘
âœ… Minh báº¡ch: Audit trail Ä‘áº§y Ä‘á»§, khÃ´ng thá»ƒ xÃ³a lá»‹ch sá»­
âœ… ThÃ´ng minh: Cáº£nh bÃ¡o rá»§i ro real-time
```

---

## 2. Má»¤C TIÃŠU & PHáº M VI

### 2.1 Má»¥c tiÃªu dá»± Ã¡n (SMART Goals)

**Má»¥c tiÃªu ká»¹ thuáº­t**:
```
S - Specific (Cá»¥ thá»ƒ):
  âœ“ XÃ¢y dá»±ng há»‡ thá»‘ng SaaS production-ready
  âœ“ Xá»­ lÃ½ Ä‘Æ°á»£c 3 loáº¡i hÃ³a Ä‘Æ¡n: XML/PDF/áº¢nh
  âœ“ Validate 3 lá»›p: Structure/Signature/Business Logic
  âœ“ Multi-tenant: Há»— trá»£ nhiá»u cÃ´ng ty (demo 2 companies)

M - Measurable (Äo lÆ°á»ng Ä‘Æ°á»£c):
  âœ“ AI accuracy â‰¥ 85% trÃªn hÃ³a Ä‘Æ¡n PDF/áº¢nh
  âœ“ API response time < 2s (p95)
  âœ“ Database query < 500ms
  âœ“ Uptime â‰¥ 99%
  âœ“ Test coverage â‰¥ 80%

A - Achievable (Kháº£ thi):
  âœ“ Team 5 ngÆ°á»i x 3 thÃ¡ng = 60 man-months
  âœ“ CÃ³ code C# XML validation sáºµn (30% cÃ´ng viá»‡c)
  âœ“ AWS Free Tier support
  âœ“ TÃ i liá»‡u phÃ¡p lÃ½ Ä‘áº§y Ä‘á»§

R - Relevant (PhÃ¹ há»£p):
  âœ“ Giáº£i quyáº¿t pain point thá»±c táº¿ cá»§a doanh nghiá»‡p
  âœ“ TuÃ¢n thá»§ quy Ä‘á»‹nh phÃ¡p luáº­t VN
  âœ“ Showcase AWS AI services (Textract)
  âœ“ Portfolio project cháº¥t lÆ°á»£ng cao

T - Time-bound (Thá»i háº¡n):
  âœ“ Week 1-4: Foundation & Core Features
  âœ“ Week 5-8: AI Integration & Testing
  âœ“ Week 9-12: Polish & Deployment
  âœ“ Deadline: End of Week 12
```

---

### 2.2 Pháº¡m vi dá»± Ã¡n (Scope)

#### âœ… TRONG PHáº M VI (In-Scope)

**A. Xá»­ lÃ½ hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­**
```
1. HÃ³a Ä‘Æ¡n GTGT (01GTKT) - Máº«u sá»‘ 01
   â”œâ”€ Äá»‹nh dáº¡ng: XML theo Quyáº¿t Ä‘á»‹nh 1550/QÄ-TCT
   â”œâ”€ Báº¯t buá»™c: Chá»¯ kÃ½ sá»‘, MST, Thuáº¿ GTGT
   â””â”€ Validation: 3 lá»›p Ä‘áº§y Ä‘á»§

2. HÃ³a Ä‘Æ¡n BÃ¡n hÃ ng (02GTTT) - Máº«u sá»‘ 02
   â”œâ”€ Äá»‹nh dáº¡ng: XML
   â”œâ”€ KhÃ´ng cÃ³: Thuáº¿ GTGT
   â””â”€ Validation: 3 lá»›p

3. HÃ³a Ä‘Æ¡n MÃ¡y tÃ­nh tiá»n (Cash Register)
   â”œâ”€ Äáº·c Ä‘iá»ƒm: CÃ³ MCCQT (MÃ£ CÆ¡ quan thuáº¿)
   â”œâ”€ Relaxed: Cho phÃ©p thiáº¿u chá»¯ kÃ½ ngÆ°á»i bÃ¡n
   â””â”€ Validation: Adjusted rules

4. HÃ³a Ä‘Æ¡n áº¢nh/PDF (OCR)
   â”œâ”€ AWS Textract AnalyzeExpense
   â”œâ”€ Mapping vá» cáº¥u trÃºc chuáº©n
   â””â”€ Risk: Yellow (thiáº¿u XML phÃ¡p lÃ½)
```

**B. Chá»©c nÄƒng há»‡ thá»‘ng**
```
1. Quáº£n lÃ½ hÃ³a Ä‘Æ¡n
   â”œâ”€ Upload (XML/PDF/JPG/PNG)
   â”œâ”€ Auto-extract data (AI + XML parser)
   â”œâ”€ Edit & Correct (Manual override)
   â”œâ”€ Submit for approval
   â”œâ”€ Approve/Reject workflow
   â””â”€ Version control (lÆ°u lá»‹ch sá»­ sá»­a Ä‘á»•i)

2. RÃ  soÃ¡t rá»§i ro (3-Layer Validation)
   â”œâ”€ Layer 1: XSD Structure validation
   â”œâ”€ Layer 2: Digital signature verification + Anti-Spoofing
   â”œâ”€ Layer 3: Business logic (MST API, Math, Mandatory fields)
   â””â”€ Risk scoring: Green/Yellow/Orange/Red

3. LÆ°u trá»¯ & TÃ¬m kiáº¿m
   â”œâ”€ Full-text search (Elasticsearch hoáº·c PostgreSQL FTS)
   â”œâ”€ Filter nÃ¢ng cao (Date range, Status, Risk level, Type)
   â”œâ”€ Sort & Pagination
   â””â”€ Quick search by Invoice#, MST, Company name

4. BÃ¡o cÃ¡o & Xuáº¥t file
   â”œâ”€ Dashboard analytics (Charts, KPIs)
   â”œâ”€ Export Excel (MISA/FAST format)
   â”œâ”€ Export PDF report
   â””â”€ Scheduled reports (optional)

5. PhÃ¢n quyá»n & Audit
   â”œâ”€ Multi-tenant isolation
   â”œâ”€ Role-based access (Member/Admin/SuperAdmin)
   â”œâ”€ Audit trail Ä‘áº§y Ä‘á»§ (WHO/WHAT/WHEN/WHY)
   â””â”€ Immutable logs (khÃ´ng thá»ƒ xÃ³a)
```

**C. TÃ­ch há»£p AWS Services**
```
âœ“ Amazon S3: File storage
âœ“ Amazon Textract: OCR AI
âœ“ Amazon RDS PostgreSQL: Database
âœ“ AWS Elastic Beanstalk: Backend hosting
âœ“ AWS Amplify: Frontend hosting
âœ“ AWS Secrets Manager: Credentials
âœ“ Amazon CloudWatch: Monitoring & Logs
âœ“ AWS IAM: Access control
```

---

#### âŒ NGOÃ€I PHáº M VI (Out-of-Scope)

```
Ã— TÃ­ch há»£p trá»±c tiáº¿p vá»›i pháº§n má»m káº¿ toÃ¡n (MISA/FAST API)
  â†’ Chá»‰ export Excel tÆ°Æ¡ng thÃ­ch

Ã— Mobile app (iOS/Android)
  â†’ Chá»‰ web responsive

Ã— Blockchain verification
  â†’ Chá»‰ digital signature verification

Ã— Real-time collaboration (Google Docs style)
  â†’ Chá»‰ audit trail

Ã— Payment gateway integration
  â†’ KhÃ´ng xá»­ lÃ½ thanh toÃ¡n

Ã— Advanced ML training (custom model)
  â†’ Chá»‰ dÃ¹ng pre-trained Textract

Ã— Multi-language support
  â†’ Chá»‰ tiáº¿ng Viá»‡t + English UI (optional)
```

---

## 3. Äá»ŠNH HÆ¯á»šNG PHÃT TRIá»‚N

### 3.1 Design Philosophy (Triáº¿t lÃ½ thiáº¿t káº¿)

Dá»± Ã¡n Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn 3 trá»¥ cá»™t:

#### **Trá»¥ cá»™t 1: TuÃ¢n thá»§ & Tá»± Ä‘á»™ng (Compliance & Automation)**
```
Má»¥c tiÃªu: Äáº£m báº£o 100% tuÃ¢n thá»§ phÃ¡p luáº­t VN vá» hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­

NguyÃªn táº¯c:
âœ“ Má»i validation rule pháº£i cÃ³ cÆ¡ sá»Ÿ phÃ¡p lÃ½ rÃµ rÃ ng
âœ“ KhÃ´ng bá» qua báº¥t ká»³ trÆ°á»ng báº¯t buá»™c nÃ o theo luáº­t
âœ“ Chá»¯ kÃ½ sá»‘ pháº£i Ä‘Æ°á»£c verify 100% (náº¿u cÃ³)
âœ“ Anti-Spoofing: MST ngÆ°á»i kÃ½ pháº£i khá»›p MST ngÆ°á»i bÃ¡n
âœ“ Cáº£nh bÃ¡o rÃµ rÃ ng khi vi pháº¡m quy Ä‘á»‹nh

Implementation:
- InvoiceProcessor.cs Ä‘Ã£ cÃ³ sáºµn logic tuÃ¢n thá»§
- ValidationLayers table lÆ°u káº¿t quáº£ tá»«ng lá»›p
- RiskReasons (JSONB) giáº£i thÃ­ch rÃµ tá»«ng warning/error
```

#### **Trá»¥ cá»™t 2: Cloud Native & Scalable (Má»Ÿ rá»™ng dá»… dÃ ng)**
```
Má»¥c tiÃªu: Kiáº¿n trÃºc sáºµn sÃ ng cho production, dá»… scale

NguyÃªn táº¯c:
âœ“ Stateless API (horizontal scaling)
âœ“ Database connection pooling
âœ“ S3 cho file storage (unlimited)
âœ“ Managed services (RDS, Beanstalk) giáº£m ops overhead
âœ“ Monitoring & Alerting tá»« Ä‘áº§u

Implementation:
- .NET Core API (stateless, async/await)
- PostgreSQL vá»›i indexes tá»‘i Æ°u
- S3 lifecycle policies (auto archive)
- CloudWatch metrics & alarms
```

#### **Trá»¥ cá»™t 3: User Experience & Transparency (Minh báº¡ch)**
```
Má»¥c tiÃªu: Giáº£m táº£i nháº­n thá»©c, tÄƒng Ä‘á»™ tin cáº­y

NguyÃªn táº¯c:
âœ“ Há»‡ thá»‘ng tá»± Ä‘á»™ng phÃ¢n loáº¡i â†’ User chá»‰ cáº§n confirm
âœ“ Cáº£nh bÃ¡o rÃµ rÃ ng, dá»… hiá»ƒu (khÃ´ng dÃ¹ng thuáº­t ngá»¯ ká»¹ thuáº­t)
âœ“ Audit trail Ä‘áº§y Ä‘á»§ â†’ Truy váº¿t 100% thay Ä‘á»•i
âœ“ Immutable logs â†’ KhÃ´ng ai xÃ³a Ä‘Æ°á»£c lá»‹ch sá»­
âœ“ Dashboard trá»±c quan â†’ KPI má»™t cÃ¡i nhÃ¬n

Implementation:
- Risk badges color-coded (Green/Yellow/Orange/Red)
- Audit log timeline UI (WHO did WHAT, WHEN)
- Dashboard vá»›i Recharts visualization
- User-friendly error messages
```

---

### 3.2 Technical Principles (NguyÃªn táº¯c ká»¹ thuáº­t)

```
1. SEPARATION OF CONCERNS
   â”œâ”€ Controllers: Nháº­n request, validate input
   â”œâ”€ Services: Business logic
   â”œâ”€ Repositories: Database access
   â””â”€ Models: Data structures

2. DEPENDENCY INJECTION
   â”œâ”€ Loose coupling
   â”œâ”€ Testable code
   â””â”€ Easy to mock

3. ASYNC/AWAIT EVERYWHERE
   â”œâ”€ Non-blocking I/O
   â”œâ”€ Better performance
   â””â”€ Scalable

4. FAIL FAST
   â”œâ”€ Validate early
   â”œâ”€ Return clear errors
   â””â”€ Don't hide exceptions

5. AUDIT EVERYTHING
   â”œâ”€ Every state change â†’ Audit log
   â”œâ”€ WHO did WHAT
   â””â”€ Immutable records

6. SECURITY BY DEFAULT
   â”œâ”€ JWT authentication
   â”œâ”€ HTTPS only
   â”œâ”€ Parameterized queries (prevent SQL injection)
   â”œâ”€ Input validation
   â””â”€ CORS properly configured
```

---

## 4. YÃŠU Cáº¦U TUÃ‚N THá»¦ PHÃP LÃ

### 4.1 Nghá»‹ Ä‘á»‹nh 123/2020/NÄ-CP

**Äiá»u 12: Ná»™i dung hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­**

Há»‡ thá»‘ng pháº£i lÆ°u trá»¯ Ä‘áº§y Ä‘á»§ cÃ¡c trÆ°á»ng theo quy Ä‘á»‹nh:

```
A. THÃ”NG TIN NGÆ¯á»œI BÃN (NBan)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Báº¯t buá»™c:
âœ“ TÃªn ngÆ°á»i bÃ¡n (Ten)
âœ“ MÃ£ sá»‘ thuáº¿ (MST)
âœ“ Äá»‹a chá»‰ (DChi)

KhÃ´ng báº¯t buá»™c nhÆ°ng nÃªn cÃ³:
â—‹ Sá»‘ Ä‘iá»‡n thoáº¡i (SDT)
â—‹ Sá»‘ tÃ i khoáº£n ngÃ¢n hÃ ng (STKNHang)
â—‹ Äá»‹a chá»‰ thÆ° Ä‘iá»‡n tá»­ (DCTDTu)

B. THÃ”NG TIN NGÆ¯á»œI MUA (NMua)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Báº¯t buá»™c (náº¿u cÃ³ MST):
âœ“ TÃªn ngÆ°á»i mua (Ten)
âœ“ MÃ£ sá»‘ thuáº¿ (MST)
âœ“ Äá»‹a chá»‰ (DChi)

KhÃ´ng báº¯t buá»™c:
â—‹ Há» tÃªn ngÆ°á»i mua hÃ ng (HVTNMHang)
â—‹ Sá»‘ Ä‘iá»‡n thoáº¡i (SDT)

C. THÃ”NG TIN CHUNG (TTChung)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Báº¯t buá»™c:
âœ“ PhiÃªn báº£n (PBan): "2.0.0"
âœ“ Loáº¡i hÃ³a Ä‘Æ¡n (THDon): "1" (GTGT) / "2" (BÃ¡n hÃ ng)
âœ“ KÃ½ hiá»‡u máº«u sá»‘ (KHMSHDon): VD "01GTKT"
âœ“ KÃ½ hiá»‡u hÃ³a Ä‘Æ¡n (KHHDon): VD "C24T"
âœ“ Sá»‘ hÃ³a Ä‘Æ¡n (SHDon): "0001234"
âœ“ NgÃ y láº­p (NLap): "2025-01-15"
âœ“ ÄÆ¡n vá»‹ tiá»n tá»‡ (DVTTe): "VND"

KhÃ´ng báº¯t buá»™c:
â—‹ MÃ£ cá»§a cÆ¡ quan thuáº¿ (MCCQT) - Báº¯t buá»™c vá»›i mÃ¡y tÃ­nh tiá»n
â—‹ HÃ¬nh thá»©c thanh toÃ¡n (HTTToan)
â—‹ Ghi chÃº (GChu)

D. DANH SÃCH HÃ€NG HÃ“A (DSHHDVu)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Má»—i dÃ²ng hÃ ng (HHDVu) báº¯t buá»™c:
âœ“ TÃ­nh cháº¥t (TChat): "1" (hÃ ng hÃ³a) / "2" (dá»‹ch vá»¥) / "3" (khuyáº¿n máº¡i)
âœ“ Sá»‘ thá»© tá»± (STT)
âœ“ TÃªn hÃ ng hÃ³a (Ten)
âœ“ ÄÆ¡n vá»‹ tÃ­nh (DVTinh)
âœ“ Sá»‘ lÆ°á»£ng (SLuong)
âœ“ ÄÆ¡n giÃ¡ (DGia)
âœ“ ThÃ nh tiá»n (ThTien)

Náº¿u lÃ  GTGT:
âœ“ Thuáº¿ suáº¥t (TSuat): "0", "5", "8", "10"
âœ“ Tiá»n thuáº¿ (TThue)

E. Tá»”NG TIá»€N (TToan)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Báº¯t buá»™c:
âœ“ Tá»•ng tiá»n chÆ°a thuáº¿ (TgTCThue)
âœ“ Tá»•ng tiá»n thuáº¿ GTGT (TgTThue) - Náº¿u lÃ  GTGT
âœ“ Tá»•ng thanh toÃ¡n báº±ng sá»‘ (TgTTTBSo)
âœ“ Tá»•ng thanh toÃ¡n báº±ng chá»¯ (TgTTTBChu)
```

**â†’ Há»‡ thá»‘ng PHáº¢I lÆ°u trá»¯ táº¥t cáº£ cÃ¡c trÆ°á»ng trÃªn trong database**

---

### 4.2 Quyáº¿t Ä‘á»‹nh 1550/QÄ-TCT

**Vá» Ä‘á»‹nh dáº¡ng file XML**:

```xml
<!-- Cáº¥u trÃºc chuáº©n theo 1550/QÄ-TCT -->
<HDon>
  <DLHDon>
    <TTChung>
      <!-- ThÃ´ng tin chung -->
    </TTChung>
    <NDHDon>
      <NBan>
        <!-- NgÆ°á»i bÃ¡n -->
      </NBan>
      <NMua>
        <!-- NgÆ°á»i mua -->
      </NMua>
      <DSHHDVu>
        <HHDVu>
          <!-- Danh sÃ¡ch hÃ ng hÃ³a -->
        </HHDVu>
      </DSHHDVu>
      <TToan>
        <!-- Tá»•ng tiá»n -->
      </TToan>
    </NDHDon>
  </DLHDon>
  <DSCKS>
    <NBan>
      <Signature>
        <!-- Chá»¯ kÃ½ sá»‘ ngÆ°á»i bÃ¡n -->
      </Signature>
    </NBan>
  </DSCKS>
</HDon>
```

**YÃªu cáº§u chá»¯ kÃ½ sá»‘** (Äiá»u 17 NÄ 123/2020):
- Báº¯t buá»™c vá»›i GTGT vÃ  BÃ¡n hÃ ng
- Chá»©ng thÆ° sá»‘ pháº£i cÃ²n hiá»‡u lá»±c
- MST trong Subject pháº£i khá»›p MST ngÆ°á»i bÃ¡n
- Sá»­ dá»¥ng thuáº­t toÃ¡n: RSA-SHA256 (phá»• biáº¿n nháº¥t)

---

### 4.3 Validation Rules theo PhÃ¡p luáº­t

Há»‡ thá»‘ng implement cÃ¡c rule sau:

```
LAYER 1: STRUCTURE VALIDATION (XSD)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ XML well-formed
âœ“ TuÃ¢n thá»§ InvoiceSchema.xsd
âœ“ CÃ¡c trÆ°á»ng báº¯t buá»™c khÃ´ng Ä‘Æ°á»£c thiáº¿u
âœ“ Kiá»ƒu dá»¯ liá»‡u Ä‘Ãºng (date, decimal, string)
â†’ Náº¿u fail: RISK = RED

LAYER 2: SIGNATURE VALIDATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Chá»¯ kÃ½ sá»‘ há»£p lá»‡ (integrity check)
âœ“ Chá»©ng thÆ° sá»‘ chÆ°a háº¿t háº¡n (optional - cáº§n cert chain)
âœ“ Anti-Spoofing: MST trong cert Subject = MST ngÆ°á»i bÃ¡n
â†’ Náº¿u missing signature (GTGT/BÃ¡n hÃ ng): RISK = YELLOW
â†’ Náº¿u signature invalid: RISK = ORANGE
â†’ Náº¿u Anti-Spoofing detected: RISK = RED

LAYER 3: BUSINESS LOGIC VALIDATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
A. Kiá»ƒm tra MST (MÃ£ sá»‘ thuáº¿)
   âœ“ Äá»‹nh dáº¡ng 10 sá»‘: Checksum Mod-11
   âœ“ Äá»‹nh dáº¡ng 13 sá»‘: 10 sá»‘ Ä‘áº§u + "-NNN"
   âœ“ Äá»‹nh dáº¡ng 12 sá»‘ (CCCD): Chá»‰ check numeric
   âœ“ Tra cá»©u VietQR API: Doanh nghiá»‡p cÃ³ hoáº¡t Ä‘á»™ng?
   â†’ Náº¿u invalid format: RISK = ORANGE
   â†’ Náº¿u inactive business: RISK = RED

B. Kiá»ƒm tra toÃ¡n há»c
   âœ“ SLuong Ã— DGia = ThTien (tolerance Â±10 VND)
   âœ“ Náº¿u GTGT: TgTCThue + TgTThue = TgTTTBSo
   âœ“ Náº¿u BÃ¡n hÃ ng: TgTCThue = TgTTTBSo
   â†’ Náº¿u sai lá»‡ch: RISK = ORANGE

C. Kiá»ƒm tra ngÃ y thÃ¡ng
   âœ“ NLap khÃ´ng Ä‘Æ°á»£c á»Ÿ tÆ°Æ¡ng lai
   âœ“ NLap pháº£i cÃ³ Ä‘á»‹nh dáº¡ng YYYY-MM-DD
   â†’ Náº¿u future date: RISK = ORANGE

D. Kiá»ƒm tra Ä‘áº·c thÃ¹ theo loáº¡i
   âœ“ MÃ¡y tÃ­nh tiá»n: Pháº£i cÃ³ MCCQT
   âœ“ GTGT: Pháº£i cÃ³ TSuat vÃ  TThue
   â†’ Náº¿u thiáº¿u: RISK = YELLOW/ORANGE
```

---

## 5. KIáº¾N TRÃšC Tá»”NG THá»‚

### 5.1 System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  React SPA (TypeScript + Material-UI)                    â”‚   â”‚
â”‚  â”‚  - Login/Auth pages                                      â”‚   â”‚
â”‚  â”‚  - Invoice Management (List/Detail/Upload/Edit)          â”‚   â”‚
â”‚  â”‚  - Dashboard & Analytics                                 â”‚   â”‚
â”‚  â”‚  - Admin panel (Approval queue, User management)         â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Hosted on: AWS Amplify                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTPS (REST API + JWT)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  .NET 6 Web API (C#)                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Controllers                                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ AuthController (Login, Register, RefreshToken)â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ InvoiceController (CRUD, Validate, Submit)    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ DashboardController (Stats, Charts)           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ ExportController (Excel, PDF)                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ AdminController (User management, Config)     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Services (Business Logic)                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ InvoiceProcessorService (3-layer validation)  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ TextractService (AWS Textract integration)    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ S3Service (File upload/download)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ ValidationService (Risk calculation)          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ SearchService (Full-text search)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ ExportService (Excel generation)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ NotificationService (Email/In-app alerts)     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Repositories (Data Access)                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ IInvoiceRepository                             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ IUserRepository                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ IAuditLogRepository                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Generic Repository Pattern                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Hosted on: AWS Elastic Beanstalk                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚             â”‚              â”‚
            â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AWS RDS    â”‚  â”‚    AWS S3    â”‚  â”‚  AWS Textract    â”‚
â”‚  PostgreSQL  â”‚  â”‚  File Bucket â”‚  â”‚  AnalyzeExpense  â”‚
â”‚              â”‚  â”‚              â”‚  â”‚                  â”‚
â”‚ - Invoices   â”‚  â”‚ - XML files  â”‚  â”‚ - OCR PDF/Image  â”‚
â”‚ - Users      â”‚  â”‚ - PDF files  â”‚  â”‚ - Extract fields â”‚
â”‚ - AuditLogs  â”‚  â”‚ - Images     â”‚  â”‚                  â”‚
â”‚ - 12 tables  â”‚  â”‚ - Exports    â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     EXTERNAL APIS                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  VietQR API (MST Verification)   â”‚  â”‚
â”‚  â”‚  https://api.vietqr.io/v2/...    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5.2 Data Flow Architecture

**Flow 1: XML Invoice Processing**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Upload  â”‚
â”‚  XML    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Upload to S3        â”‚
â”‚     - Validate file ext â”‚
â”‚     - Generate S3 key   â”‚
â”‚     - Upload async      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Create Invoice record (Draft) â”‚
â”‚     - Save metadata to DB          â”‚
â”‚     - Status = "Draft"             â”‚
â”‚     - ProcessingMethod = "XML"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. InvoiceProcessorService          â”‚
â”‚     â”œâ”€ Download XML from S3          â”‚
â”‚     â”œâ”€ Layer 1: XSD Validation       â”‚
â”‚     â”œâ”€ Layer 2: Signature Check      â”‚
â”‚     â””â”€ Layer 3: Business Logic       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Calculate Risk Level             â”‚
â”‚     - Green: All pass                â”‚
â”‚     - Yellow: Minor issues           â”‚
â”‚     - Orange: Medium risk            â”‚
â”‚     - Red: Critical issues           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Save ValidationResult to DB      â”‚
â”‚     - Update Invoice                 â”‚
â”‚     - Create ValidationLayers        â”‚
â”‚     - Create RiskCheckResults        â”‚
â”‚     - Create AuditLog (UPLOAD)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Return to   â”‚
â”‚     Frontend    â”‚
â”‚     - Show risk â”‚
â”‚     - Show data â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Flow 2: PDF/Image Invoice Processing (OCR)**
```
User Upload PDF/JPG
     â”‚
     â–¼
1. Upload to S3
     â”‚
     â–¼
2. Create Invoice (Draft, ProcessingMethod="OCR")
     â”‚
     â–¼
3. TextractService.AnalyzeExpenseAsync()
     â”œâ”€ Call AWS Textract API
     â”œâ”€ Wait for response (2-5s)
     â””â”€ Parse response JSON
     â”‚
     â–¼
4. Map Textract fields to Invoice model
     â”œâ”€ INVOICE_RECEIPT_ID â†’ InvoiceNumber
     â”œâ”€ INVOICE_RECEIPT_DATE â†’ InvoiceDate
     â”œâ”€ TOTAL â†’ TotalAmount
     â”œâ”€ VENDOR_NAME â†’ Seller info
     â””â”€ Confidence scores
     â”‚
     â–¼
5. Basic Risk Check
     â”œâ”€ Missing XML â†’ Yellow
     â”œâ”€ Low confidence (<70%) â†’ Orange
     â””â”€ Invalid format â†’ Orange
     â”‚
     â–¼
6. Save to DB
     â”œâ”€ RawData = Textract response (JSONB)
     â”œâ”€ ExtractedData = Mapped data
     â””â”€ RiskLevel
     â”‚
     â–¼
7. Return to Frontend
     - Show extracted data
     - Show confidence scores
     - Allow manual correction
```

**Flow 3: Approval Workflow**
```
Member:
  Upload â†’ Edit (optional) â†’ Submit
                              â”‚
                              â–¼
                        Status = "Pending"
                              â”‚
                              â–¼
                        Notification â†’ Admin
                              â”‚
                              â–¼
Admin:                  Review Invoice
  â”œâ”€ If OK  â†’ Approve â†’ Status = "Approved"
  â””â”€ If NOT â†’ Reject  â†’ Status = "Rejected"
                              â”‚
                              â–¼
                        AuditLog created
                              â”‚
                              â–¼
                        Notification â†’ Member
```

---

## 6. THIáº¾T Káº¾ DATABASE PRODUCTION

### 6.1 Database Schema Overview

**Tá»•ng quan**: 12 tables (bá» Tags nhÆ° yÃªu cáº§u)

```
CORE ENTITIES (6 tables):
â”œâ”€ Companies (Multi-tenant)
â”œâ”€ Users (Authentication & Authorization)
â”œâ”€ Invoices (Central entity)
â”œâ”€ FileStorages (S3 file metadata)
â”œâ”€ DocumentTypes (Invoice classifications)
â””â”€ ValidationLayers (3-layer validation results)

SUPPORT ENTITIES (6 tables):
â”œâ”€ InvoiceAuditLogs (Immutable audit trail)
â”œâ”€ RiskCheckResults (Detailed risk analysis)
â”œâ”€ Notifications (In-app alerts)
â”œâ”€ ExportHistories (Export tracking)
â”œâ”€ AIProcessingLogs (Textract metrics)
â””â”€ SystemConfigurations (App settings)
```

---

### 6.2 Detailed Schema Design

TÃ´i sáº½ táº¡o file riÃªng cho database schema chi tiáº¿t do ná»™i dung quÃ¡ dÃ i. File nÃ y sáº½ bao gá»“m:
- 12 tables vá»›i má»i trÆ°á»ng theo Nghá»‹ Ä‘á»‹nh 123/2020
- Indexes production-ready
- Constraints & Foreign keys
- Sample data
- Migration scripts

---

**[Tiáº¿p theo: Pháº§n II Database Detail sáº½ Ä‘Æ°á»£c táº¡o trong file riÃªng]**

TÃ i liá»‡u nÃ y Ä‘ang Ä‘Æ°á»£c xÃ¢y dá»±ng, tÃ´i sáº½ táº¡o cÃ¡c file bá»• sung:
1. DATABASE_SCHEMA_PRODUCTION.md - Chi tiáº¿t 12 tables
2. API_SPECIFICATION.md - REST API documentation
3. TEAM_HANDBOOK.md - PhÃ¢n cÃ´ng 5 ngÆ°á»i + Timeline
4. DEPLOYMENT_GUIDE_PRODUCTION.md - AWS deployment chi tiáº¿t

Báº¡n cÃ³ muá»‘n tÃ´i tiáº¿p tá»¥c táº¡o cÃ¡c file nÃ y khÃ´ng?
